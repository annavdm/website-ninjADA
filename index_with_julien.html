<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>r/TheAnatomyOfAHater</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.plot.ly/plotly-3.3.0.min.js"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="assets/css/style.css">


</head>

<body>

  <!-- ===== Top Bar ===== -->
  <div class="topbar">
    <div class="logo">
      <img src="images/Reddit_Logo.png" alt="Reddit">
      reddit
    </div>

    <div class="search" role="search">
      <span class="searchIcon" aria-hidden="true">üîé</span>
      <input type="search" placeholder="Search Reddit" aria-label="Search Reddit">
    </div>
  </div>

  <!-- ===== Main Layout ===== -->
  <div class="app">

    <!-- ===== Left Sidebar ===== -->
    <aside class="sidebar">
      <div class="subreddit-title">r/TheAnatomyOfAHater</div>
      <a href="#post-1">üìå Dataset Presentation</a>
      <a href="#post-2">üåç Geopolitics</a>
      <a href="#post-3">üé¨ Pop Culture</a>
      <a href="#post-4">üß© Reddit Core</a>
      <a href="#post-5">üß† Mental Health</a>
    </aside>

    <!-- ===== Feed ===== -->
    <main class="feed">

      <!-- ================== POST #1 ================== -->
      <article class="post" id="post-1" tabindex="0" aria-expanded="false">
        <!-- Closed view (title + picture) -->
        <div class="post-summary" role="button" aria-label="Open post">
          <div class="post-header">
            <img src="images/Reddit_Logo.png" alt="Subreddit icon" class="post-icon">
            <div class="post-meta">
              <div class="post-subreddit">r/TheAnatomyOfAHater</div>
              <div class="post-author">Posted by u/NinjADA ‚Ä¢ pinned ‚Ä¢ 2025</div>
            </div>
          </div>

          <div class="post-title-row">
            <h1 class="post-title">The Anatomy of a Hater</h1>
          </div>

          <img class="post-thumb" src="images/reddit-img3.png" alt="Post preview image">

          <div class="post-actions" aria-label="Post actions">
            <button class="vote-btn up" type="button" aria-label="Like">‚ñ≤</button>
            <span class="vote-score" aria-label="Score">0</span>
            <button class="vote-btn down" type="button" aria-label="Dislike">‚ñº</button>
            <span class="action-sep">‚Ä¢</span>
            <span class="open-hint">Click to open</span>
          </div>
        </div>

        <!-- Open view (full post) -->
        <div class="post-full">
          <div class="post-topbar" role="button" aria-label="Close post">
            <button class="back-btn" type="button" aria-label="Back">‚Üê</button>
            <div class="topbar-title">The Anatomy of a Hater</div>
          </div>

          <div class="post-body">
            <!-- IMAGE before Introduction + hover bubbles -->
            <div class="hover-hate-wrapper" id="hateZone">
              <img
                src="images/reddit-img3.png"
                alt="Reddit visualization"
                class="hover-hate-image"
              >
              <div class="hover-bubble-layer" id="hoverBubbleLayer"></div>
            </div>

            <section id="introduction">
              <h2>Introduction</h2>
              <p class="intro-big-text">
                Online conflict is rising, and social media often turns into a stage for anonymous negativity.
                Using a Reddit dataset (2014‚Äì2017), we trace how subreddits link to each other and reveal a hidden network of hostility.
                Focusing on the 10% of interactions tagged as negative, we dive into the profiles of the users who spread this hostility:
                their communities, writing styles, targets, and posting habits.
                By uncovering how these ‚Äúhaters‚Äù operate, we aim to shed light on the dynamics that fuel online anger.
              </p>
            </section>

            <section id="research-questions">
              <h2>Research Questions</h2>
              <div class="rq-grid">
                <div class="rq-card">Is a hater likely to be active in certain subreddits?</div>
                <div class="rq-card">Are there persisting conflicts between subreddits?</div>
                <div class="rq-card">Does a hater have a particular way of writing?</div>
              </div>
            </section>

            <section id="data-presentation">
              <h2>Data Presentation</h2>

              <section id="dataset-embeddings">
                <h3>Subreddit Embeddings</h3>
                <p class="data-intro">
                  So the dataset takes about 2.5 years of Reddit activity in 51,278 unique subreddits, then turns each subreddit into a 300-dimensional vector
                  that captures ‚Äúwho posts where,‚Äù meaning that subreddits that have similar users end up close together in the embedding space.
                </p>

                <label for="plotSelectorA">Choose a plot:</label>
                <select id="plotSelectorA">
                  <option value="pca_2d">2D PCA</option>
                  <option value="tsne">t-SNE</option>
                </select>

                <div class="plot-panel" id="plotA-pca_2d">
                  <iframe src="plots/subreddit_pca_2d.html" height="450" title="Subreddit Embeddings in 2D"></iframe>
                </div>

                <div class="plot-panel" id="plotA-tsne" style="display:none;">
                  <iframe src="plots/tsne_on_pca.html" height="450" title="Subreddit embedding after t-SNE"></iframe>
                </div>
              </section>

              <section id="dataset-hyperlinks">
                <h3>Hyperlink Network Dataset</h3>
                <p class="data-intro">
                  So now there‚Äôs this giant network of Reddit where every time one subreddit links to another, it counts as a little arrow from
                  ‚Äúsource‚Äù to ‚Äútarget.‚Äù
                </p>

                <label for="plotSelectorB">Choose a plot:</label>
                <select id="plotSelectorB">
                  <option value="sentiment">Sentiment distribution</option>
                  <option value="body_vs_title">Body vs title</option>
                </select>

                <div class="plot-panel" id="plotB-sentiment">
                  <p class="plot-caption">
                    Hostile posts represent about 10% of the dataset ‚Äî the goal is to understand what characterizes that ‚Äúred‚Äù portion.
                  </p>
                  <iframe src="plots/sentiment_distribution.html" height="450" title="Sentiment distribution"></iframe>
                </div>

                <div class="plot-panel" id="plotB-body_vs_title" style="display:none;">
                  <p class="plot-caption">The dataset provides information on where the link is located ‚Äî either title or body.</p>
                  <iframe src="plots/body_title_sentiment.html" height="450" title="Body vs title"></iframe>
                </div>
              </section>
            </section>

            <section id="anatomy-of-a-hater">
              <h2>Anatomy of a Hater</h2>
              <p>
                We cluster subreddits into communities to see if some are more ‚Äúhater-friendly‚Äù than others.
              </p>

              <div class="plot-panel">
                <iframe src="plots/subreddit_pca_clusters_2d.html" height="450" title="Clusters"></iframe>
              </div>

              <div class="plot-panel">
                <iframe src="plots/cluster_treemap.html" height="450" title="Treemap"></iframe>
              </div>
            </section>

            <section id="conclusion">
              <h2>Conclusion</h2>
              <p>
                This project maps hostile interactions between communities and starts sketching the behavioral ‚Äúprofile‚Äù of haters.
              </p>
            </section>

            <footer>¬© 2025 NinjADA Team</footer>
          </div>
        </div>
      </article>

      <!-- ================== POST #2 ================== -->
      <article class="post" id="post-2" tabindex="0" aria-expanded="false">
        <div class="post-summary" role="button" aria-label="Open post">
          <div class="post-header">
            <img src="images/icon-geopo.png" alt="r/GeoPolitics icon" class="post-icon">
            <div class="post-meta">
              <div class="post-subreddit">r/GeoPolitics</div>
              <div class="post-author">Posted by u/NinjADA ‚Ä¢ 2025</div>
            </div>
          </div>

          <div class="post-title-row">
            <h1 class="post-title">r/Geo-Politics</h1>
          </div>

          <img class="post-thumb--preview" src="" alt="Geopolitics preview">

          <div class="post-actions">
            <button class="vote-btn up" type="button" aria-label="Like">‚ñ≤</button>
            <span class="vote-score" aria-label="Score">0</span>
            <button class="vote-btn down" type="button" aria-label="Dislike">‚ñº</button>
            <span class="action-sep">‚Ä¢</span>
            <span class="open-hint">Click to open</span>
          </div>
        </div>

        <div class="post-full">
          <div class="post-topbar" role="button" aria-label="Close post">
            <button class="back-btn" type="button" aria-label="Back">‚Üê</button>
            <img
            src="images/icon-geopo.png"
            alt="r/Geopo icon"
            class="post-icon post-icon--hero"
          >
            <div class="topbar-title">r/Geo-Politics</div>
          </div>

          <div class="post-body">
            <h2>What counts as ‚Äúhate‚Äù here?</h2>
            <p>
              We use the dataset‚Äôs hostile/non-hostile labels on subreddit-to-subreddit links.

            </p>
            <section>
              <h2>Negative links over time</h2>
              <p class="plot-caption">
                Monthly count of negative links sent vs received for Geo-Politics.
              </p>
            
              <div class="plot-panel" id="negative_links_geopo">
                <iframe
                  src="plots/reactions_dynamics/negative_links_geopo.html?v=3"
                  title="Negative links over time ‚Äî Geo-Politics"
                  >
              </iframe>
              
              
              </div>

              <div class="plot-panel" id="network_geopo">
                <iframe
                  src="plots/reactions_dynamics/network_geopo.html?v=3"
                  title="Network‚Äî Geo-Politics">
                </iframe>
              </div>

              <div class="plot-panel" id="sankey_geopo">
                <iframe
                  src="plots/reactions_dynamics/sankey-geopo.html"
                  title="Sankey Geo-Politics">
                </iframe>
              </div>

              <div class="plot-panel" id="sankey_geopo">
                <iframe
                  src="plots/reactions_dynamics/spikes_pop_table_geopo.html"
                  title="Sankey Geo-Politics">
                </iframe>
              </div>

              <div class="plot-panel" id="sankey_geopo">
                <iframe
                  src="plots/reactions_dynamics/geopo_year_dropdown.html"
                  title="Sankey Geo-Politics">
                </iframe>
              </div>

              <section class="result-card">
                <h1>Negative link activity after attack peaks</h1>
              
                <div class="result-header">
                  <span class="result-cluster">Geo-Politics</span>
                  <span class="result-badge significant">Statistically significant</span>
                </div>
              
                <div class="result-meta">
                  <span class="chip">47 spikes</span>
                  <span class="chip">7-day window</span>
                  <span class="chip">Tested on rate</span>
                </div>
              
                <div class="result-metrics">
                  <div class="metric">
                    <div class="label">Before</div>
                    <div class="value">26.79</div>
                    <div class="sub">mean rate</div>
                  </div>
              
                  <div class="arrow">‚Üí</div>
              
                  <div class="metric">
                    <div class="label">After</div>
                    <div class="value">28.64</div>
                    <div class="sub">mean rate</div>
                  </div>
              
                  <div class="delta positive">
                    <div class="delta-value">+1.85</div>
                    <div class="delta-sub">(+6.9%)</div>
                  </div>
                </div>
              
                <div class="result-footer">
                  <div class="pval">p = 0.00079</div>
                  <div class="note">
                    Mean change across 47 hostility spikes.
                  </div>
                </div>
              </section>
              


        

              
              
            </section>
            

            <h2>Limitations</h2>
            <p>
              Reddit context is messy: sarcasm, brigading, moderation changes, and cross-posting can all affect interpretation.
            </p>

            <footer>¬© 2025 NinjADA Team</footer>
          </div>
        </div>
      </article>

      <!-- ================== POST #3 ================== -->
      <article class="post" id="post-3" tabindex="0" aria-expanded="false">
        <div class="post-summary" role="button" aria-label="Open post">
          <div class="post-header">
            <img src="images/icon-pop.png" alt="r/PopCulture icon" class="post-icon">
            <div class="post-meta">
              <div class="post-subreddit">r/PopCulture</div>
              <div class="post-author">Posted by u/NinjADA ‚Ä¢ 2025</div>
            </div>
          </div>

          <div class="post-title-row">
            <h1 class="post-title">r/Pop-Culture</h1>
          </div>

          <img class="post-thumb" src="images/popculture_preview.png" alt="Pop culture preview">

          <div class="post-actions">
            <button class="vote-btn up" type="button" aria-label="Like">‚ñ≤</button>
            <span class="vote-score">0</span>
            <button class="vote-btn down" type="button" aria-label="Dislike">‚ñº</button>
            <span class="action-sep">‚Ä¢</span>
            <span class="open-hint">Click to open</span>
          </div>
        </div>

        <div class="post-full">
          <div class="post-topbar" role="button" aria-label="Close post">
            <button class="back-btn" type="button" aria-label="Back">‚Üê</button>
            <img
            src="images/icon-pop.png"
            alt="r/Pop-culture icon"
            class="post-icon post-icon--hero"
          >
            <div class="topbar-title">r/Pop-Culture</div>
          </div>

          <div class="post-body">
            <h2>Content</h2>
            <p>(Fill this post content.)</p>

            <h2>Limitations</h2>
            <p>(Fill this post limitations.)</p>

            <footer>¬© 2025 NinjADA Team</footer>
          </div>
        </div>
      </article>

      <!-- ================== POST #4 ================== -->
      <article class="post" id="post-4" tabindex="0" aria-expanded="false">
        <div class="post-summary" role="button" aria-label="Open post">
          <div class="post-header">
            <img src="images/icon-reddit.png" alt="r/RedditCore icon" class="post-icon">
            <div class="post-meta">
              <div class="post-subreddit">r/RedditCore</div>
              <div class="post-author">Posted by u/NinjADA ‚Ä¢ 2025</div>
            </div>
          </div>

          <div class="post-title-row">
            <h1 class="post-title">r/Reddit Core</h1>
          </div>

          <img class="post-thumb" src="images/redditcore_preview.png" alt="Reddit core preview">

          <div class="post-actions">
            <button class="vote-btn up" type="button" aria-label="Like">‚ñ≤</button>
            <span class="vote-score">0</span>
            <button class="vote-btn down" type="button" aria-label="Dislike">‚ñº</button>
            <span class="action-sep">‚Ä¢</span>
            <span class="open-hint">Click to open</span>
          </div>
        </div>

        <div class="post-full">
          <div class="post-topbar" role="button" aria-label="Close post">
            <button class="back-btn" type="button" aria-label="Back">‚Üê</button>
            <img
            src="images/icon-reddit.png"
            alt="r/Reddit icon"
            class="post-icon post-icon--hero"
          >
            <div class="topbar-title">r/Reddit Core</div>
          </div>

          <div class="post-body">
            <h2>Content</h2>
            <p>(Fill this post content.)</p>

            <h2>Limitations</h2>
            <p>(Fill this post limitations.)</p>

            <footer>¬© 2025 NinjADA Team</footer>
          </div>
        </div>
      </article>

      <!-- ================== POST #5 ================== -->
      <article class="post" id="post-5" tabindex="0" aria-expanded="false">
        <div class="post-summary" role="button" aria-label="Open post">
          <div class="post-header">
            <img src="images/icon-health.png" alt="r/MentalHealth icon" class="post-icon post-icon--hero">          
            <div class="post-meta">
              <div class="post-subreddit">r/MentalHealth</div>
              <div class="post-author">Posted by u/NinjADA ‚Ä¢ 2025</div>
            </div>
          </div>

          <div class="post-title-row">
            <h1 class="post-title">r/Mental Health</h1>
          </div>

          <img class="post-thumb" src="images/mentalhealth_preview.png" alt="Mental health preview">

          <div class="post-actions">
            <button class="vote-btn up" type="button" aria-label="Like">‚ñ≤</button>
            <span class="vote-score">0</span>
            <button class="vote-btn down" type="button" aria-label="Dislike">‚ñº</button>
            <span class="action-sep">‚Ä¢</span>
            <span class="open-hint">Click to open</span>
          </div>
        </div>

        <div class="post-full">
          <div class="post-topbar" role="button" aria-label="Close post">
            <button class="back-btn" type="button" aria-label="Back">‚Üê</button>
            
            <img
              src="images/icon-health.png"
              alt="r/MentalHealth icon"
              class="post-icon post-icon--hero"
            >
            <div class="topbar-title">r/Mental Health</div>
          </div>


          <div class="post-body">
            <h2>Content</h2>
            <p>(Fill this post content.)</p>

            <h2>Limitations</h2>
            <p>(Fill this post limitations.)</p>

            <footer>¬© 2025 NinjADA Team</footer>
          </div>
        </div>
      </article>
       
      <!-- -------------------------TRUCS DE JULIEN -------------------------------------- -->
      <section id="haters-schedule">
      <h2>The Hater's Schedule</h2>
      <p> Do haters have a specific time schedule ? Is there more negativity during summer than during winter ? Or on the week-end as opposed to during the week ? </p>
      <p>Let's plot the data and find out !</p>




        <label for="datasetSelector">Select Dataset</label>
    <select id="datasetSelector">
      <option value="full">Full Dataset</option>
      <option value="geopolitics">Cluster Geopolitics</option>
      <option value="popculture">Cluster Pop-Culture</option>
    </select>

    <label for="timespanSelector">Timespan</label>
    <select id="timespanSelector">
      <option value="complete">Complete length</option>
      <option value="week">Average week</option>
    </select>

    <!-- hidden plot panels -->
    <div class="plot-panel" id="plotD-full-complete" style="display: none;">
      <iframe src="plots/julien/full_complete.html" height="450" title="Full Dataset complete length" style="width: 100%; border: none;"></iframe>
    </div>
    <div class="plot-panel" id="plotD-full-week" style="display: none;">
      <iframe src="plots/julien/full_week.html" height="450" title="Full Dataset average week" style="width: 100%; border: none;"></iframe>
    </div>
    <div class="plot-panel" id="plotD-geopolitics-complete" style="display: none;">
      <iframe src="plots/julien/geopolitics_complete.html" height="450" title="Cluster Geopolitics complete length" style="width: 100%; border: none;"></iframe>
    </div>
    <div class="plot-panel" id="plotD-geopolitics-week" style="display: none;">
      <iframe src="plots/julien/geopolitics_week.html" height="450" title="Cluster Geopolitics average week" style="width: 100%; border: none;"></iframe>
    </div>
    <div class="plot-panel" id="plotD-popculture-complete" style="display: none;">
      <iframe src="plots/julien/popculture_complete.html" height="450" title="Cluster Pop-Culture complete length" style="width: 100%; border: none;"></iframe>
    </div>
    <div class="plot-panel" id="plotD-popculture-week" style="display: none;">
      <iframe src="plots/julien/popculture_week.html" height="450" title="Cluster Pop-Culture average week" style="width: 100%; border: none;"></iframe>
    </div>


    <p> There seems to be no discernable pattern sadly </p>
    <p>(en fait j'ai ditch un peu mes analyses de regression mais je devrais essayer de les mettre, et en faire plus ?)</p>

    </section>



    <section id="external-factors">
      <h2>Is the hater sensitive to world events ? </h2>
      <p>After having examined the negative posting behavior over time, we wonder if it is possible to see the effect of important events on the amount of negatitivity posted on Reddit. Intuitively this would make sense : if some 
        controversial event happens in the real world, some Redditors will probably post about it in a deragotive manner or argue about it. With some luck and if the event is important enough, there would be 
        enough discussion on the subject inside or between subreddits, generating enough hyperlinks associated with a negative link sentiment such that we detect a change.
      </p>
      <div class="plot-container">
        <iframe
          src="plots/julien/event_analysis.html" title="Negativity & Events" width="100%" height="700" style="border:none;">
        </iframe>
      </div>
      <p>Of course here we are only detecting correlation, not causation. Trump's election correlates quite strongly with a decrease in negativity among the dataset overall. Is it because Redditors are happy about the election ? 
        Is it actually because the campaigning preceding the election has higher above average negativity due to the political tensions, and that the period after the election simply went back to the normal rate ? 
        Is it because of some completely different exterior factor (maybe Redditors are just less negative in November than in September in general) ? Those questions are still open. 
    </section>
    <!-- -------------------------TRUCS DE JULIEN fin -------------------------------------- -->

    </main>

    <!--===== Right Sidebar ===== -->
    <aside class="about">
      <div class="about-box">
        <strong>About this subreddit</strong>
        <p>Data-driven analysis of online hostility on Reddit (2014‚Äì2017).</p>
      </div>

      <div class="about-box">
        <strong>Rules</strong>
        <p>
          1. Be respectful<br>
          2. Data-based discussion only
        </p>
      </div>
    </aside>

  </div>

  <!-- ===== Hover bubbles JS (post #1 open view) ===== -->
  <script>
    const NEGATIVE_COMMENTS = [
      "This makes no sense.",
      "Completely missing the point.",
      "Another bad Reddit take.",
      "You‚Äôre reading way too much into this.",
      "That conclusion is a stretch.",
      "Nice graph, wrong interpretation.",
      "This is why comments are locked.",
      "Correlation ‚â† causation."
    ];

    const hateZone = document.getElementById("hateZone");
    const layer = document.getElementById("hoverBubbleLayer");

    let bubbleInterval = null;

    function randomItem(arr){ return arr[Math.floor(Math.random() * arr.length)]; }
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function spawnBubble(){
      const bubble = document.createElement("div");
      const life = 2000 + Math.random() * 2200;

      bubble.className = "hover-bubble";
      bubble.style.setProperty("--life", `${life}ms`);
      bubble.textContent = randomItem(NEGATIVE_COMMENTS);

      const rect = layer.getBoundingClientRect();
      const x = rect.width  * (0.25 + Math.random() * 0.5);
      const y = rect.height * (0.25 + Math.random() * 0.5);

      layer.appendChild(bubble);

      const bw = bubble.offsetWidth;
      const bh = bubble.offsetHeight;

      bubble.style.left = `${clamp(x - bw / 2, 10, rect.width - bw - 10)}px`;
      bubble.style.top  = `${clamp(y - bh / 2, 10, rect.height - bh - 10)}px`;

      setTimeout(() => bubble.remove(), life + 350);
    }

    function startBubbles(){
      if (bubbleInterval) return;
      spawnBubble();
      bubbleInterval = setInterval(() => spawnBubble(), 900 + Math.random() * 700);
    }

    function stopBubbles(){
      clearInterval(bubbleInterval);
      bubbleInterval = null;
      layer.innerHTML = "";
    }

    if (hateZone) {
      hateZone.addEventListener("mouseenter", startBubbles);
      hateZone.addEventListener("mouseleave", stopBubbles);
    }
  </script>

  <script>
    // Plot toggles (only exist in Post #1 open view)
    const selectorA = document.getElementById('plotSelectorA');
    const panelsA = {
      pca_2d: document.getElementById('plotA-pca_2d'),
      tsne: document.getElementById('plotA-tsne')
    };

    const selectorB = document.getElementById('plotSelectorB');
    const sentimentDiv = document.getElementById('plotB-sentiment');
    const bodyVsTitleDiv = document.getElementById('plotB-body_vs_title');

      // Time Series toggle (Plot D) 
    const datasetSelector = document.getElementById('datasetSelector');
    const timespanSelector = document.getElementById('timespanSelector');
    const panelsD = {
      'full-complete': document.getElementById('plotD-full-complete'),
      'full-week' : document.getElementById('plotD-full-week'),
      'geopolitics-complete' : document.getElementById('plotD-geopolitics-complete'),
      'geopolitics-week' : document.getElementById('plotD-geopolitics-week'),
      'popculture-complete' : document.getElementById('plotD-popculture-complete'),
      'popculture-week' : document.getElementById('plotD-popculture-week'),
    };


    function updatePlotA() {
      if (!selectorA) return;
      const choice = selectorA.value;
      Object.values(panelsA).forEach(p => { if (p) p.style.display = 'none'; });
      if (panelsA[choice]) panelsA[choice].style.display = 'block';
    }

    function updatePlotB() {
      if (!selectorB) return;
      const choice = selectorB.value;
      if (choice === 'sentiment') {
        if (sentimentDiv) sentimentDiv.style.display = 'block';
        if (bodyVsTitleDiv) bodyVsTitleDiv.style.display = 'none';
      } else {
        if (sentimentDiv) sentimentDiv.style.display = 'none';
        if (bodyVsTitleDiv) bodyVsTitleDiv.style.display = 'block';
      }
    }


  function updatePlotD() {
    // Hide all panels first
    Object.values(panelsD).forEach(p => p.style.display = 'none');
    
    // Show selected combination
    const dataset = datasetSelector.value;
    const timespan = timespanSelector.value;
    const key = `${dataset}-${timespan}`;
    console.log('Dataset:', dataset, 'Timespan:', timespan, 'Key:', key);
    console.log('Available panels:', Object.keys(panelsD));

    
    if (panelsD[key]) {
      panelsD[key].style.display = 'block';
      }
    }


    if (selectorA) selectorA.addEventListener('change', updatePlotA);
    if (selectorB) selectorB.addEventListener('change', updatePlotB);
    datasetSelector.addEventListener('change', updatePlotD);
    timespanSelector.addEventListener('change', updatePlotD);
    updatePlotA();
    updatePlotB();
    updatePlotD();
  </script>

  <script>
    // ===== Feed open/close + like/dislike under each card =====
    const body = document.body;
    const posts = document.querySelectorAll(".post");

    function closeAllPosts() {
      posts.forEach(p => {
        p.classList.remove("is-open");
        p.setAttribute("aria-expanded", "false");
      });
      body.classList.remove("viewing-post");
    }

    function openPost(post) {
      closeAllPosts();
      post.classList.add("is-open");
      post.setAttribute("aria-expanded", "true");
      body.classList.add("viewing-post");
      post.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    posts.forEach((post) => {
      const summary = post.querySelector(".post-summary");
      const topbar = post.querySelector(".post-topbar");
      const backBtn = post.querySelector(".back-btn");

      // open when clicking the card summary (title/picture)
      summary?.addEventListener("click", (e) => {
        // ignore clicks on vote buttons
        if (e.target.closest(".vote-btn")) return;
        openPost(post);
      });

      // close when clicking back button
      backBtn?.addEventListener("click", (e) => {
        e.stopPropagation();
        closeAllPosts();
      });

      // close when clicking the open post topbar area (like clicking the post header)
      topbar?.addEventListener("click", (e) => {
        if (e.target.closest("button")) return;
        closeAllPosts();
      });

      // keyboard open (Enter / Space) on post
      post.addEventListener("keydown", (e) => {
        if (e.key !== "Enter" && e.key !== " ") return;
        e.preventDefault();
        if (post.classList.contains("is-open")) closeAllPosts();
        else openPost(post);
      });

      // voting logic (per post)
      const upBtn = post.querySelector(".vote-btn.up");
      const downBtn = post.querySelector(".vote-btn.down");
      const scoreEl = post.querySelector(".vote-score");

      let score = 0;
      let vote = 0; // -1, 0, +1

      function renderVote() {
        if (scoreEl) scoreEl.textContent = String(score);
        upBtn?.classList.toggle("is-active", vote === 1);
        downBtn?.classList.toggle("is-active", vote === -1);
      }

      upBtn?.addEventListener("click", (e) => {
        e.stopPropagation();
        if (vote === 1) { vote = 0; score -= 1; }
        else { if (vote === -1) score += 1; vote = 1; score += 1; }
        renderVote();
      });

      downBtn?.addEventListener("click", (e) => {
        e.stopPropagation();
        if (vote === -1) { vote = 0; score += 1; }
        else { if (vote === 1) score -= 1; vote = -1; score -= 1; }
        renderVote();
      });

      renderVote();
    });

    // ESC closes
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeAllPosts();
    });
  </script>


</body>
</html>
